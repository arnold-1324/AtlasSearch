!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const e=function(e){if(!e)return"";let t=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");return t=t.replace(/```(\w*)([\s\S]*?)```/g,(e,t,n)=>`<pre><code class="language-${t}">${n.trim()}</code></pre>`),t=t.replace(/`([^`]+)`/g,"<code>$1</code>"),t=t.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),t=t.replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank">$1</a>'),t=t.split("\n\n").map(e=>e.includes("<pre>")?e:`<p>${e.replace(/\n/g,"<br>")}</p>`).join(""),t},t="ws://127.0.0.1:18789",n="ws://127.0.0.1:18792/extension",s=document.getElementById("chat-history"),c=document.getElementById("message-input"),o=document.getElementById("send-btn"),a=document.getElementById("connection-status"),i=document.getElementById("settings-btn"),r=document.getElementById("tutorial-btn"),l=document.getElementById("context-bar"),d=document.getElementById("tab-status-text"),u=document.getElementById("tab-status-icon"),m=document.getElementById("connect-tab-btn"),g=document.getElementById("view-chat"),y=document.getElementById("view-settings"),p=document.getElementById("view-tutorial"),E=document.querySelectorAll(".back-btn"),v=document.getElementById("gatewayUrl"),h=document.getElementById("gatewayToken"),f=document.getElementById("relayUrl"),w=document.getElementById("save-settings"),L=document.getElementById("reset-settings"),T=document.getElementById("settings-status"),W=document.getElementById("writeAccess");let b=!1;function C(e){g.classList.remove("active"),y.classList.remove("active"),p.classList.remove("active"),"chat"===e?g.classList.add("active"):"settings"===e?y.classList.add("active"):"tutorial"===e&&p.classList.add("active")}function I(){chrome.storage.local.get(["gatewayUrl","gatewayToken","relayPort","relayUrl","writeAccess"],e=>{v.value=e.gatewayUrl||t,h.value=e.gatewayToken||"";let n=e.relayUrl;if(!n){n=`ws://127.0.0.1:${e.relayPort||"18792"}/extension`}f.value=n,W.checked=!!e.writeAccess})}function k(e,t){T.textContent=e,T.className=`status-msg ${t}`,T.style.display="block",setTimeout(()=>{T.style.display="none"},3e3)}function B(e,t){l.className=`context-bar ${e}`,m.style.display="none",m.disabled=!1,m.textContent="Connect";let n="âšª",s=t||"Unknown Tab";"connected"===e?(n="ðŸŸ¢",s=`Linked: ${t}`):"disconnected"===e?(n="âšª",s="Not connected",m.style.display="block"):"restricted"===e?(n="ðŸš«",s="Restricted Page"):"connecting"===e&&(n="ðŸŸ¡",s="Connecting...",m.style.display="block",m.disabled=!0,m.textContent="..."),u.textContent=n,d.textContent=s,d.title=s}function U(e){a.className="status-indicator "+e,a.title=e.charAt(0).toUpperCase()+e.slice(1),b="connected"===e,"connected"===e?A("system","Connected to OpenClaw Gateway."):"disconnected"===e?A("system","Disconnected from OpenClaw Gateway."):"connecting"===e&&A("system","Connecting...")}function S(){const e=c.value.trim();e&&(b?(A("user",e),c.value="",c.style.height="40px",chrome.runtime.sendMessage({type:"SEND_MESSAGE",content:e})):A("system","Cannot send message: Disconnected."))}function A(t,n){const c=document.createElement("div");c.className=`message ${t}`,"bot"===t?c.innerHTML=e(n):c.textContent=n,s.appendChild(c),s.scrollTop=s.scrollHeight}document.addEventListener("DOMContentLoaded",()=>{chrome.runtime.sendMessage({type:"GET_STATUS"},e=>{e&&U(e.status)}),chrome.runtime.sendMessage({type:"GET_TAB_STATUS"}),c.focus(),I()}),i.addEventListener("click",()=>{I(),C("settings")}),r.addEventListener("click",()=>{C("tutorial")}),E.forEach(e=>{e.addEventListener("click",()=>{"view-chat"===e.getAttribute("data-target")&&C("chat")})}),w.addEventListener("click",function(){const e=v.value.trim()||t,s=h.value.trim(),c=f.value.trim()||n;if(!e.startsWith("ws"))return void k("Gateway URL must start with ws:// or wss://","error");if(!c.startsWith("ws"))return void k("Relay URL must start with ws:// or wss://","error");let o=18792;try{const e=new URL(c);e.port&&(o=parseInt(e.port,10))}catch(a){}chrome.storage.local.set({gatewayUrl:e,gatewayToken:s,relayUrl:c,relayPort:o,writeAccess:W.checked},()=>{k("Settings saved successfully.","success"),chrome.runtime.sendMessage({type:"CONFIG_UPDATED"})})}),L.addEventListener("click",function(){v.value=t,h.value="",f.value=n,W.checked=!1,k("Reset to defaults. Click Save to apply.","success")}),m.addEventListener("click",()=>{B("connecting","Connecting..."),chrome.runtime.sendMessage({type:"CONNECT_CURRENT_TAB"},e=>{e&&e.success||B("disconnected","Connection failed")})}),o.addEventListener("click",S),c.addEventListener("keydown",e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),S())}),chrome.runtime.onMessage.addListener((e,t,n)=>{"STATUS_UPDATE"===e.type?U(e.status):"TAB_STATUS_UPDATE"===e.type?B(e.status,e.title):"INCOMING_MESSAGE"===e.type?A("bot",e.content):"ERROR_MESSAGE"===e.type&&A("system",e.content)}),c.addEventListener("input",function(){this.style.height="auto",this.style.height=this.scrollHeight+"px",""===this.value&&(this.style.height="40px")});
